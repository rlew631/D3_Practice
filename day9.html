<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <![endif]-->
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <svg id="legend" width="900" height="24" style="solid #ccc"></svg>
    <svg id="white-square" width="900" height="500" style="border:1px solid #ccc"></svg>
    <script>
      data = [{"location":"USA","total":100.55120328935703,"BEEF":26.7293486139702,"PIG":23.302141032229,"POULTRY":50.0713589267626,"SHEEP":0.44835471639525},{"location":"AUS","total":92.5681787987675,"POULTRY":44.7674041728219,"SHEEP":7.20902767405751,"BEEF":18.3061203554003,"PIG":22.2856265964878},{"location":"ARG","total":89.9427094864333,"BEEF":39.6930414166216,"PIG":11.1075472308644,"POULTRY":38.182081438707,"SHEEP":0.960039400240306},{"location":"ISR","total":88.40525840765655,"BEEF":20.3276273859528,"PIG":1.36284163216104,"POULTRY":65.1118153302743,"SHEEP":1.60297405926842},{"location":"BRA","total":77.67262419623773,"BEEF":24.5911002492012,"PIG":12.2711994305261,"POULTRY":40.2605168496156,"SHEEP":0.549807666894842},{"location":"CHL","total":75.38989278442358,"BEEF":18.8933783544562,"PIG":19.2662894192094,"POULTRY":36.8155707739482,"SHEEP":0.414654236809779},{"location":"NZL","total":74.89795722541282,"BEEF":11.7664204185344,"PIG":18.9349293469092,"POULTRY":39.613317689444,"SHEEP":4.58328977052522},{"location":"CAN","total":68.1470478204473,"BEEF":17.6454236226423,"PIG":15.7406044106492,"POULTRY":33.8710827065993,"SHEEP":0.889937080556491},{"location":"RUS","total":63.55871535345712,"BEEF":10.3456620585043,"PIG":20.0975976880051,"POULTRY":31.6716749419491,"SHEEP":1.44378066499862},{"location":"GBR","total":61.13611112058715,"BEEF":11.6668055859047,"PIG":17.0314199725123,"POULTRY":28.3163298179107,"SHEEP":4.12155574425945},{"location":"MYS","total":60.772179642652794,"BEEF":5.30436100458042,"PIG":5.30104677348496,"POULTRY":49.0022597853396,"SHEEP":1.16451207924782},{"location":"KOR","total":60.39080759951781,"BEEF":11.0347836121123,"PIG":30.8206399658315,"POULTRY":18.2311487228892,"SHEEP":0.304235298684807},{"location":"NOR","total":55.411118755045244,"BEEF":13.7036363719495,"PIG":19.7360798652557,"POULTRY":17.5796079912433,"SHEEP":4.39179452659674},{"location":"PER","total":54.43018864811629,"BEEF":4.14165144943747,"PIG":4.18296274187409,"POULTRY":45.0454016733068,"SHEEP":1.06017278349793},{"location":"VNM","total":53.08195842801508,"BEEF":9.45751420873198,"PIG":29.957099864496,"POULTRY":13.4975711507851,"SHEEP":0.169773204001996},{"location":"ZAF","total":52.436733353256436,"BEEF":12.3555298043504,"PIG":3.4497553099765,"POULTRY":34.018691664539,"SHEEP":2.61275657439054},{"location":"MEX","total":51.98227011543677,"BEEF":8.77373567141306,"PIG":13.4418609465089,"POULTRY":29.2488024629443,"SHEEP":0.517871034570511},{"location":"CHE","total":51.17638010443171,"BEEF":13.2201062913529,"PIG":22.5009003562741,"POULTRY":14.30701789114,"SHEEP":1.14835556566471},{"location":"COL","total":49.986574918693464,"BEEF":10.6763078140775,"PIG":8.04178947139757,"POULTRY":31.1245320622453,"SHEEP":0.143945570973092},{"location":"CHN","total":48.3690931781674,"BEEF":3.80705448931226,"PIG":29.2504859587862,"POULTRY":12.1347008977943,"SHEEP":3.17685183227464},{"location":"KAZ","total":47.77318419394016,"BEEF":19.4713571923728,"PIG":4.77257110775444,"POULTRY":15.2282660776928,"SHEEP":8.30098981612012},{"location":"PRY","total":40.82858728334916,"BEEF":13.6763904190466,"PIG":21.3535942122811,"POULTRY":5.29623124597125,"SHEEP":0.50237140605021},{"location":"SAU","total":40.75950088127431,"BEEF":4.01976796574177,"PIG":0.498059463842157,"POULTRY":32.4257730962324,"SHEEP":3.81590035545799},{"location":"JPN","total":40.74920923533209,"BEEF":7.43955698794546,"PIG":16.1523276505959,"POULTRY":16.9962765322175,"SHEEP":0.16104806457323},{"location":"UKR","total":40.13916000657804,"BEEF":5.03282430366614,"PIG":12.5421457543804,"POULTRY":22.2816961175811,"SHEEP":0.282493830950404},{"location":"WLD","total":34.43433217281387,"BEEF":6.43130388768072,"PIG":11.9786817118672,"POULTRY":14.2980869204296,"SHEEP":1.72625965283635},{"location":"IRN","total":32.29435455725237,"BEEF":5.2866950166685,"PIG":0.016953211579378,"POULTRY":22.943479319586,"SHEEP":4.04722700941849},{"location":"TUR","total":32.29005072702591,"PIG":0.0000017780931028699,"POULTRY":19.3514543910214,"SHEEP":4.36462933139113,"BEEF":8.57396522652027},{"location":"PHL","total":31.797539159411617,"BEEF":3.11867458779578,"PIG":14.6652790802124,"POULTRY":13.4972308681987,"SHEEP":0.516354623204736},{"location":"EGY","total":21.40387497168775,"BEEF":8.21757939012228,"PIG":0.00714059185472626,"POULTRY":12.0894899527381,"SHEEP":1.08966503697264},{"location":"THA","total":19.338335054286365,"BEEF":1.31102901273759,"PIG":9.99085890471849,"POULTRY":7.99283101270446,"SHEEP":0.0436161241258223},{"location":"PAK","total":14.419378702369846,"BEEF":6.39492385504998,"PIG":0.0000038123830968464,"POULTRY":5.97191395762301,"SHEEP":2.05253707731376},{"location":"IDN","total":10.987807373315173,"BEEF":1.98390566707599,"PIG":1.00556646599705,"POULTRY":7.56930570019135,"SHEEP":0.429029540050782},{"location":"NGA","total":4.988501236865099,"BEEF":1.3415416944737,"PIG":1.04818309242728,"POULTRY":0.860357858664559,"SHEEP":1.73841859129956},{"location":"IND","total":3.615142011260617,"BEEF":0.52973188018674,"PIG":0.167764805304175,"POULTRY":2.45549780202629,"SHEEP":0.462147523743412},{"location":"ETH","total":3.0271498642911707,"BEEF":2.54367185793091,"PIG":0.0146179728311529,"POULTRY":0.114176719287873,"SHEEP":0.354683314241235}]
      data.categories = ["PIG", "POULTRY", "SHEEP", "BEEF"]
      width = 900; height = 500
      margin = {top: 10, right: 0, bottom: 30, left: 30}

      colors = d3.scaleOrdinal(
        data.categories,
        d3.schemeGnBu[9].slice(3)
      )

      xScale = d3.scaleBand(
        data.map(d => d.location),
        [ margin.left, width - margin.right ]
      ).padding(0.2)

      yScale = d3.scaleLinear(
        [ 0, d3.max(data, d => d.total) ],
        [ height - margin.bottom, margin.top ]
      )

      xAxis = d3.axisBottom(xScale)
        .tickSizeOuter(0)

      yAxis = d3.axisLeft(yScale)

      stack = d3.stack()
        .keys( data.categories )

      function legend() {
        svg = d3.select('#legend')
        
        svg.selectAll('g')
          .data( data.categories.slice(0).reverse() )
          .join('g')
            .attr('transform', (d,i) => `translate(${i * 80},5)`)
          .call(g => g
            .append('rect')
              .attr('width', 20)
              .attr('height', 20)
              .style('fill', d => colors(d))
          )
          .call(g => g
            .append('text')
              .attr('y', 10)
              .attr('x', 25)
              .attr('dy', '0.35em')
              .style('font-size', 12)
              .style('font-family', 'sans-serif')
            .text(d => d[0] + d.slice(1).toLowerCase())
          )
        
        return svg.node()
      } 
      legend()

      function chart() {
        // const svg = d3.create('svg')
        //     .attr('width', 900)
        //     .attr('height', 500)
        svg = d3.select('#white-square')

        // Pass our data to the stack to generate the layer positions
        const chartData = stack( data ) 

        const groups = svg.append('g')
          // Each layer of the stack goes in a group
          // the group contains that layer for all countries
          .selectAll('g')
          .data( chartData )
          .join('g')
            // rects in the same layer will all have the same color, so we can put it on the group
            // we can use the key on the layer's array to set the color
            .style('fill', (d,i) => colors(d.key))

        groups.selectAll('rect')
          // Now we place the rects, which are the children of the layer array
          .data(d => d)
          .join('rect')
            .attr('x', d => xScale(d.data.location))
            .attr('y', d => yScale(d[1]))
            .attr('height', d => yScale(d[0]) - yScale(d[1]))
            .attr('width', xScale.bandwidth())

        svg.append('g')
          .attr('transform', `translate(0,${ height - margin.bottom })`)
          .call(xAxis)

        svg.append('g')
          .attr('transform', `translate(${ margin.left },0)`)
          .call(yAxis)
          .select('.domain').remove()

        return svg.node()
      }
      chart()
    </script>
  </body>
</html>